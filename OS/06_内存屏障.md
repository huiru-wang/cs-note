

# 指令乱序

CPU为了性能优化，可能对指令进行重排序，在单线程的情况下可以保证是安全的；
- **CPU重排序**：CPU执行过程中动态的修改指令顺序，可能是缓存miss，需要等待，但是后续代码不依赖缓存，可能就乱序先执行了；
- **编译器优化**：编译器在编译期间静态的对代码进行分析，如果保证正确且可以优化，有可能对代码进行顺序调整；编译器优化的灵活度远高于CPU重排序，可以优化的范围很大；

但是在多线程的场景下，这类优化可能产生不可预知的问题；

# 内存屏障

内存屏障是


**内存屏障**(Memory Barrier)则是通过在特定的指令前后插入屏障，**保证在屏障前的读写，都会早于屏障后的读写**，保证指令的顺序性；