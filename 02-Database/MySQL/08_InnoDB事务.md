# 事务是什么？
事务：通常是一系列的操作，组成一个工作单元，保证不可分割，全部操作执行成功或全部失败；

MySQL事务是由InnoDB引擎实现的，InnoDB存储引擎支持的ACID特性，是由锁机制、MVCC、事务日志、redo/undo log等来保证的；

# 为什么需要事务？
**1、数据一致性**：当多个用户同时访问数据库时，可能会出现数据不一致的情况。通过使用事务，可以确保每个操作都被完全执行或者完全撤销，从而使得数据库保持一致性。

**2、数据可靠性**：如果一个事务在处理过程中发生错误，所有对数据库的修改都会被回滚，以便让数据库恢复到原始状态。这避免了在错误状态下导致数据被损坏的风险。

**3、并发控制**：由于MySQL支持并发访问，可能会出现多个用户同时对同一资源进行读写操作的情况。通过使用事务，可以防止并发操作带来的数据冲突问题，从而保证数据的完整性和正确性。

# ACID特性
**原子性Atomicity：undolog保证**

一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性；

**一致性Consistency**

保证并发访问下事务前后数据的正确性、以及分布式场景下的主从一致性；

一致性是数据库的根本目标，最终结果，由其他三个特性共同来保证；

**隔离性Isolation：锁/MVCC保证**

通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。保证并发场景下的数据一致性问题；

**持久性durability：redolog/binlog来保证**

一旦事务提交，则其所做的修改会永久保存到数据库。

# 事务隔离级别
多事务读写并发访问数据库，可能会导致一些并发问题，常见的并发问题有：

**1、脏读**：一个事务对数据进行增删改，但并没有提交，另一个事务却能读到未提交的数据；

**2、不可重复读**：前后多次读取，数据内容不一致；一事务对数据进行了更新或删除操作，提交后，另一事务中再次读取同一个数据，结果不一致；

**3、幻读**：前后多次执行同样的读操作，返回的==数据量==不一致；

---
为避免并发问题、适应各种事务场景，关系型数据库的事务一般会提供不同的隔离级别来避免并发问题；

- InnoDB默认级别：**Repeatable Read**；
- ==隔离级别由低到高，并发性能降低、数据一致性提高==；
- 隔离级别是通过锁机制、MVCC机制来实现的；

| 隔离级别                    | 级别           | 脏读   | 不可重复读 | 幻读                 |
| --------------------------- | -------------- | ------ | :--------- | -------------------- |
| **Read Uncomitted读未提交** | 无保证         | 存在   | 存在       | 存在                 |
| **Read Comitted读已提交**   | 语句级         | 不存在 | 存在       | 存在                 |
| **Repeatable Read可重复读** | 事务级         | 不存在 | 不存在     | 存在(解决了部分幻读) |
| **Serializable串行化**      | 最高级，效率低 | 不存在 | 不存在     | 不存在               |

RR级别下：

- MVCC通过快照读解决了只读场景的幻读现象；
- Next-Key Lock解决了当前读场景下的幻读；
- 当快照读和当前读同时出现在一个事务，仍会出现幻读现象；


# 事务相关配置
```conf
# 事务超时时间
innodb_lock_wait_timeout = 5000;

```