- [客户端模拟测试](#客户端模拟测试)
- [服务端性能指标](#服务端性能指标)
- [系统活跃度指标](#系统活跃度指标)
- [系统性能评价方式](#系统性能评价方式)
  - [1. 并发量的预估](#1-并发量的预估)
  - [2. TPS计算](#2-tps计算)
  - [3. 压测](#3-压测)
  - [4. 服务线程数的设定](#4-服务线程数的设定)
- [可靠性指标](#可靠性指标)
- [可扩展性](#可扩展性)

# 客户端模拟测试

1、并发量：同时的请求个数；

2、线程数：模拟的执行发送请求的线程数(虚拟用户数)，此参数完全取决于执行机的能力，如果要实现1000的并发量，是100个线程执行100次，还是10个线程执行1000次，对于服务端完全无感知；问题在于执行机的性能是否足够触发到这个并发量；

# 服务端性能指标

**QPS**：单台服务器每秒能够响应的查询数；

- 不包含查询之外复杂逻辑，不适合衡量通常的服务器性能；
- 多用于衡量单纯查询服务器（MySQL、Redis）

**TPS**：Transaction Per Second；服务器每秒处理事务数；单个事务包含多个操作，作为吞吐量指标更合理；

- 事务：接受请求，完整处理请求（包含增删改查、外部依赖等），返回响应；
- 比较能衡量通用的服务器吞吐量；

**RT**：Response Time；一次请求的响应时长；

- 侧重于用户体验的性能指标，直接影响用户感受；

**并发量**：同一时刻到达的请求数；

# 系统活跃度指标

PV：Page View 页面访问量；

UV：Unique View 独立访客数，针对用户去重后的数量；

DAU：日活跃用户；

# 系统性能评价方式

## 1. 并发量的预估
- 历史数据：已上线系统，可以使用历史数据；一般选取峰值的在线用户数；但是同时在线不一定同时使用系统，可能只是挂着，所以取10%作为并发用户数即可；
- 预估数据：新系统，需要业务部门、产品等进行评估；或者根据众测阶段的效果来评估；开放给一部分用户；

参考值：
- 中小普通系统：2000~5000
- 大型并发系统：10000以上

## 2. TPS计算

- 历史数据：已上线系统，可以取峰值时间段的某个接口的调用总量，计算出每秒完成的接口数，再增加2~5倍，作为TPS要求的一个指标，
- 预估数据：新系统，需要业务部门、产品等进行评估；

## 3. 压测
在预估的并发请求量下，进行压测，达到目标TPS；

如果没达到目标TPS，则考虑：优化接口：[接口优化思路](../Web/%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF.md)

## 4. 服务线程数的设定
需要明确：
1. 任务类型
2. 任务的CPU耗时

- CPU密集型：这类任务执行中由于不需要等待IO，因此不需要过多的线程；
  - **线程数 == CPU核数即可**
- IO密集型：需要计算任务中的计算和IO时间占比；得出经验公式：$N * (1 + \frac{WT}{CT})$
  - 其中，N：CPU核数；WT：IO等待时间；CT：CPU计算时间；
  - 当WT==CT，线程数可以设为2N；
  - IO等待时间占比越大，可以适当从2N往上增加线程数；

# 可靠性指标

可用性 = 1-(故障时间/系统运行时间) = 系统可用总时间/系统运行总时间

一般用几个9来衡量，最少要3个9：99.9%的时间都是可用的，日故障时间在2分钟内；

# 可扩展性

系统应该具备通用的横向、纵向扩展能力；

- 纵向扩展：提高单机处理能力
  - 升级硬件：内存、磁盘升级等
  - 提升软件：增加缓存、异步化等等
- 横向扩展：达到单机极限，需要横向扩展，通过增加进程，提高系统性能
  - 无状态水平扩容，有状态路由扩容

---

参考：

https://help.aliyun.com/document_detail/29343.html

https://cloud.tencent.com/developer/article/1653881
