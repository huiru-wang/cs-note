
# HTTPS

## TLS/SSL

HTTPS = HTTP + TLS/SSL(应用层协议)

SSL：Secure Socket Layer，安全套接字层,已经更名为TLS;

TLS：传输层安全协议，是 SSL3.0 的后续版本，更安全，更完善；

- TLS 1.1,1.2(废弃)
  
- TLS 1.2(主流)
  
- TLS 1.3(性能更好,更安全)
  

TLS建立在传输层、应用层之间,为应用层提供数据封装、压缩、加解密等功能；

## HTTPS握手过程

![](../images/https.png?msec=1678122903987)

1、客户端发起HTTPS请求(443端口)，告知服务端，自己支持的**TLS版本**、**加密套件**、和**第1个随机数**

2、服务端**确认支持的TLS版本**、**选择的加密套件**、并生成**第2个随机数**，返回给客户端  

3、随后服务端发送**CA证书**(含有服务端公钥和CA签名)给客户端  

4、服务端发送Server Hello结束报文 

5、客户端使用**CA公钥**(内置于操作系统)验签服务端证书，并获取服务端公钥；

6、客户端生成第3个随机数，并使用公钥加密，发送给服务端，服务端私钥解密拿到预主密钥(第三个随机数)

> 只有客户端、服务端知道 预主密钥  
> 双方通过3个随机数 计算出 会话密钥，第三个随机数不会被中间人替换；

7、服务端确认握手完成，后续数据通信，都使用**随机数生成的会话密钥**进行加密通信

> 非对称加密：用于交换信息、验证身份、保障获取对称密钥；
> 对称加密：效率高，用于最终业务数据通信

## 为什么需要3个随机数

HTTPS握手过程是铭文传输的，使用多个随机数计算得到最终的通信密钥，更不容易破解；


## HTTPS加密什么

HTTPS对整个 `Http header + Http body` 进行加密；

```
GET https://cn.bing.com/fd/ls/lsp.aspx HTTP/1.1

HOST: https://cn.bing.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X)
Keep-Alive: 300
Connection: keep-alive
```